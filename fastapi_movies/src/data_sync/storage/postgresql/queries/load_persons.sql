CREATE TEMP TABLE temp_persons ASSELECT   p.id uuid,   p.full_name,   p.created,   p.modifiedFROM content.person pLIMIT 100;CREATE TEMP TABLE temp_person_filmworks ASSELECT   p.uuid,   p.full_name,   pf.film_work_id,   fw.title,   fw.rating,   ARRAY_AGG(pf.role) as rolesFROM temp_persons pJOIN content.person_film_work pfON p.uuid=pf.person_idJOIN content.film_work fwON pf.film_work_id=fw.idGROUP BY p.uuid, p.full_name, pf.film_work_id, fw.title, fw.rating;SELECT   uuid,   full_name,   COALESCE (json_agg(DISTINCT jsonb_build_object(      'id', film_work_id,      'roles', roles,      'title', title,      'rating', rating   )), '[]') as "films"FROM temp_person_filmworksGROUP BY uuid, full_name